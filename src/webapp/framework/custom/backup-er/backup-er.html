<style>
    backup-er {
        width: 100%;
        height: 100%;
        position: relative;
        box-sizing: border-box;
    }

    backup-er #add {
        width: 100%;
        padding: 10px 20px 10px 20px;
        box-sizing: border-box;
        position: relative;
        -webkit-box-shadow: 0px 2px 2px 0px rgba(0, 0, 0, 0.75);
        -moz-box-shadow: 0px 2px 2px 0px rgba(0, 0, 0, 0.75);
        box-shadow: 0px 2px 2px 0px rgba(0, 0, 0, 0.75);
        z-index: 101;
        background-color: #2d2d2d;
    }

    /* vc-scroll {
        height: calc(100% - 58px) !important;
    } */

    backup-er #container {
        padding: 10px 20px 0px 20px;
        box-sizing: border-box;
    }
</style>

<template>
    <vc-button id="add" value="Add" onclick="document.querySelector('backup-er').add();"></vc-button>
    <vc-scroll thickness="8">
        <div id="container"></div>
    </vc-scroll>
</template>

<script>
    vcomet.element("backup-er", null, {

        dependencies: [
            "../../vcomet/ui/vc-button",
            "../backup-folder"
        ],

        properties: {},

        privateProperties: {
            refs: {
                value: {}
            },
            misc: {
                value: {}
            }
        },

        functions: {
            add: function (key) {
                var el = this;
                    var data = el._refs.appcontainer.getData("backups");
                var backupFolder = document.createElement("backup-folder");
                if (key) {
                    backupFolder.id = key;
                    backupFolder.from = data[key].from;
                    backupFolder.to = data[key].to;
                    backupFolder.watch = data[key].watch;
                    backupFolder.exclude = data[key].exclude;
                } else {
                    var id = "0";

                    if (data) {
                        var currentBackup = data[id];
                        while (currentBackup) {
                            id = "" + (parseInt(id) + 1);
                            currentBackup = data[id];
                        }

                        data[id] = {};
                    } else {
                        data = {};
                        data[id] = {};
                    }
                    backupFolder.id = id;
                    el._refs.appcontainer.saveData("backups", data);
                }
                el._refs.container.appendChild(backupFolder);
            },
            updateData: function (backupFolder) {
                var el = this;
                var data = el._refs.appcontainer.getData("backups");
                var currentData = {};                
                currentData.from = backupFolder.from;
                currentData.to = backupFolder.to;
                currentData.watch = backupFolder.watch;
                currentData.exclude = backupFolder.exclude;
                data[backupFolder.id] = currentData;
                el._refs.appcontainer.saveData("backups", data);                                
            }
        },

        privateFunctions: {
            init: function () {
                var el = this;
                el._setRefs();
                var data = el._refs.appcontainer.getData("backups");                
                for (var key in data) {
                    el.add(key);
                }
            },
            setRefs: function () {
                var el = this;
                el._refs.container = el.querySelector("#container");
                el._refs.appcontainer = document.querySelector("app-container");
            }
        },

        onCreated: function () {},

        onReady: function () {
            var el = this;
            el._init();
        }


    });
</script>