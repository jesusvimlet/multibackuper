<style>
    backup-er {
        width: 100%;
        height: 100%;
        position: relative;
        box-sizing: border-box;
    }
</style>

<template>
    <component-add max-height="calc(100% - 50px)">
    </component-add>
</template>

<script>
    vcomet.element("backup-er", null, {

        dependencies: [
            "../backup-folder",
            "../component-add"
        ],

        properties: {},

        privateProperties: {
            refs: {
                value: {}
            },
            misc: {
                value: {}
            }
        },

        functions: {
            add: function (key) {
                var el = this;
                var data = el._refs.appcontainer.getData("backups");
                var backupFolder = document.createElement("backup-folder");
                backupFolder.parent = el;
                if (key) {
                    backupFolder.id = key;
                    backupFolder.from = data[key].from;
                    backupFolder.to = data[key].to;
                    backupFolder.watch = data[key].watch;
                    backupFolder.exclude = data[key].exclude;
                } else {
                    var id = "0";

                    if (data) {
                        var currentBackup = data[id];
                        while (currentBackup) {
                            id = "" + (parseInt(id) + 1);
                            currentBackup = data[id];
                        }

                        data[id] = {};
                    } else {
                        data = {};
                        data[id] = {};
                    }
                    backupFolder.id = id;
                    el._refs.appcontainer.saveData("backups", data);
                }
                el._refs.componentAdd.add(backupFolder);
            },
            updateData: function (backupFolder) {
                var el = this;
                var data = el._refs.appcontainer.getData("backups");
                var currentData = {};
                currentData.from = backupFolder.from;
                currentData.to = backupFolder.to;
                currentData.watch = backupFolder.watch;
                currentData.exclude = backupFolder.exclude;
                data[backupFolder.id] = currentData;
                el._refs.appcontainer.saveData("backups", data);
            }
        },

        privateFunctions: {
            init: function () {
                var el = this;
                el._setRefs();
                var data = el._refs.appcontainer.getData("backups");
                el._refs.componentAdd.onadd(function () {
                    el.add();
                });
                for (var key in data) {
                    el.add(key);
                }
            },
            setRefs: function () {
                var el = this;
                el._refs.componentAdd = el.querySelector("component-add");
                el._refs.appcontainer = document.querySelector("app-container");
            }
        },

        onCreated: function () {},

        onReady: function () {
            var el = this;
            el._init();
        }


    });
</script>